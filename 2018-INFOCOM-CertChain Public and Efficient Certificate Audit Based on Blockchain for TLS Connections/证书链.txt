http://vlambda.com/wz_wHdTGrEbeL.html

证书链：基于区块链的支持公开和高效的证书审计系统

1INTRODUCTION

HTTPS是一种全球广泛采用的安全网络通信协议，基础是TLS协议
TLS协议建立在 PKI公钥基础设施上。
PKI中的证书授权机构（CA）负责签名并颁发证书，它是保证完整性、机密性的基础。
CA应该成为可信第三方，但是它也有可能被攻击。
例如TurkTrust, CNNIC(中国互联网络信息中心), DSDtestProvider
等知名CA都曾经出现过由于黑客攻击而造成未授权证书发放的情况。

区块链是一种特殊的分布式数据库，它可以维护不断增长的记录且保持一致性。
本文希望能够利用区块链来实现 证书管理系统，解决CA现存的一些问题。

利用区块链记录证书 和证书操作 来 提供公开的审计，可快速发现CA是否被攻击。

引入区块链会带来三个问题：
首先事实上的中心：POW，POS，等共识协议容易形成中心节点，控制区块链的增长；

其次是强制遍历：如果简单的存储证书于区块链，如果要查询一个证书之前的操作，只能通过遍历整个区块的方式查找记录。

第三是区块大小限制：单个区块空间受限，存储空间和查询效率受到挑战。

本文有五个主要贡献：
CertChain可抵抗证书伪造和篡改攻击，实现安全高效的证书查询；

为了避免事实上的中心化，设计了一种基于可靠度的分布式共识协议实现信任分散；

为了解决强制遍历问题，提出了新的数据结构CertOper用来记录证书操作，保证证书操作的可追溯性和高效的查询响应；

设计了一种基于双计数器布隆过滤器（DCBF）的撤销证书检查方法，可以消除误报率。

部署了一个原型系统来评价CertChain的实际性能。


2PROBLEM STATEMENT  第二部分问题描述
A. System Model

这是系统框架设计图。有四类实体：domain，CA，Bookkeeper，client

多对CA和bookkeeper构成联合证书管理框架，实现基于区块链的身份管理系统 
由它们维护证书链

domain向CA请求签名证书，CA将证书操作存入区块链中；
当client与domain建立连接时，client需要到区块链中去查询domain证书操作的证明，包括证书的存在性证明和撤销查询。



威胁模型

(1)  敌手可以为恶意domain签发证书；

(2)  敌手可以插入、删除或 修改证书操作，造成client验证证书失败；

(3)  敌手可以攻击部分bookkeeper来控制区块链。



设计目标

(1)  公平共识：通过动态调整，每个bookkeeper有相似的概率产生区块并记录证书操作；

(2)  高效查询：每个证书对应的所有操作均可以被追踪并且不需要遍历区块链，证书撤销信息仅需查询最新区块即可；

(3)  入侵容忍：CA等实体管理员通过自审计可查询区块链发现恶意行为。

这是Certchain的一个框架图。从底向上分为数据层，网络层，扩展层，应用层。

数据层包括 描述证书操作的数据结构CertOper 并将其以Merkle Hash Tree（MHT）的数据结构记录在区块链上
还包括存储证书撤销信息的双计数器布隆过滤器（DCBF）

在网络层，现有的网络协议和传输机制就可以兼容系统了。

扩展层包括分布式的基于可靠度的共识机制和 CA与bookkeeper间的激励机制。

应用层包括 证书操作 和验证功能的设计


在数据层使用了新的数据结构CertOper（类似于X.509证书）
在CertOper这个数据结构中设计新字段，
如证书操作者、操作类型、当前证书hash、上一次证书操作所在高度值等字段来描述证书操作。
如图3所示可以（就可以根据上一证书操作的高度值字段可完整的链接一个证书的完整的生命周期，以）保证证书操作的可追溯性。

为了高效的存储撤销证书信息，利用Bloom Filter（BF）来记录撤销证书
但是BF存在误报率，为了能够删除元素，并且消除误报率，设计了双计数器布隆过滤器（DCBF）
分别用来存储有效证书和撤销证书，经过两轮验证，依然误报的概率极小
这些误报证书可直接在区块链中查询，以达到消除误报率的目的。

扩展层主要介绍了 基于可靠度的共识机制  和 激励机制。


共识协议包括两个部分内容：初始化和链的增长。
初始化即每个bookkeeper广播自己的公钥PKi以及可靠度Di，形成创世区块。
链的增长分为两步：区块链的同步和新区块的加入。

一个是链的同步
bookkeeper收集网络中所有广播的链，并验证这些区块，选择最长的链同步到本地；

另一个是新区块的生成。
当某个bookkeeper被选为证书操作记录者，也就是leader，它将生成新的区块，并记录到证书链中。

激励机制将CA的经济利益、bookkeeper被选为记账人的概率，以及恶意行为的举报与奖惩相关联

CA和它对应的bookkeeper共用一个可靠度，可靠度将作为是否选择该CA签发证书的一个指标

可靠度也影响bookkeeper被选为记账人概率。

CA 合法操作或举报恶意操作可以增加可靠度

CA签发或记录恶意证书会导致可靠度下降

应用层主要包括 证书的注册、更新、撤销、验证

证书注册与更新步骤类似，均由domain向CA发起请求，CA生成对应的证书操作CertOper
（证书操作类型不同，且注册操作中“上一操作所在区块高度值”字段为空）
并将其发送到bookkeeper，存入区块链 

并将证书记录到有效证书计数器布隆过滤器中

撤销可由domain或CA发起，bookkeeper会将该证书从有效证书CBF中删除，并将其添加到撤销证书CBF中。
      

这是证书撤销检查的流程图，可以快速查询证书撤销状态并且无误报率

EXPERIMENT AND EVALUATION
最后是实验结果

证书链是基于以太坊实现的
以太坊区块大小限制是2MB，这里是6.7s出一个区块,每个CertOper大小是1.8千字节

假设有百万证书为基础，撤销证书占比约为5%，DCBF的大小约为412千字节，所有CertOper和DCBF均存储于区块之中。

测量了证书操作（注册、更新、撤销）验证的时候，相关实体的时间开销

还针对空间开销与网络延迟，对类似方案进行比较

CCSP，标准BF 和CBF在不同撤销证书比例下占用的空间如图所示

CCSP采用bitmap记录撤销证书，花费的存储空间最小
CBF是将BF的bit位换成计数器，因此占用空间较大
但是相比于区块空间，CBF的占用空间可以接受。

TLS握手延迟主要取决于查询撤销证书的效率

OCSP约花费250ms，CCSP 约花费120ms，证书链的网络延迟约为55ms







