

各位同学好，今天给大家介绍一篇计算机系统方向 OSDI 2020的论文。blockene，通过移动设备来实现高吞吐量的区块链系统。

移动设备都是轻量级的，比如手机，移动设备的数量可以达到百万级别。

区块链主要是解决了，可信交易管理的问题。交易可以是任何领域的，如金融交易，财产转让等。

传统的交易模型是使用一个每个人都信任的中间人。在金融领域，中间人是银行。土地交易中，信任政府的产权登记部门。这些中间人执行两种角色：第一，他们存储世界状态，比如某块土地今天属于谁。第二，他们验证交易的有效性。比如A给B转账1000元，银行要确保A至少有1000元的余额。

但是在某些情况下，找到这样的可信中间人并不容易。比如在慈善、非盈利组织、公共支出领域。

这样的情况下，就可以使用区块链来提供分布式的信任。区块链提供了通用的交易语义，但是不需要信任单一的一个中间人。在区块链中，谁来存储世界状态呢？由区块链系统的参与者合作来存储世界状态。通过多方间的共识协议来验证交易的有效性。

区块链的关键特性在于，即便有三分之一的参与者是恶意的，账本的一致性仍然能够得到保障。

目前大致将区块链系统分为两类：以加密货币为代表的公链，以商业应用为代表的联盟链。公链系统中可以包括大量的参与者，可以是百万级的。但是公链的交易吞吐量非常低。联盟链为较为通用的商业场景而设计。交易吞吐量较高，但使用标准的拜占庭共识，对参与者数量的限制较大。

2017年提出的AlgoRand，同时支持大规模参与者数量和持续的高交易吞吐量。这些系统都是资源密集型的。公链的工作量证明共识消耗资源最多，是计算密集型的。联盟链和AlgoRand为了进行gossip传输，对网络、存储资源消耗很多。
这些区块链系统在移动网络的场景下并不适用。blockene支持高交易吞吐量、大规模参与者，同时只需要在手机上运行软件，消耗的资源也很少，是非常轻量级的。

接下来我们可以看一下，blockene适合的社会应用场景。
比如印度每年收到非盈利组织的捐款超过100亿。但是对于款项的使用却缺乏可审计性或者透明性。关于这些款项如何使用。是否真的被用到受益者身上的问题都无法得到回答。

如果有基于区块链的平台来追踪款项的流动，可以追踪款项从捐款人到最后的受益者。

另一个例子是公共支出，比如政府分发物资。如果中间人腐败的话，物资分发就不到位。

为什么规模和轻量级很重要？

大规模的参与者会使得系统更加安全。区块链系统本身假设至少三分之二的参与者是诚实的。联盟链中参与者太少，容易出现合谋的情况。
如果区块链是由数百万的公民共同维护的，那么针对区块链系统的合谋攻击会很难实现。

轻量级的软件，使得公民更加容易接受在手机上运行这个软件，参与区块链系统。可以引入更大规模的参与者。

blockene的特性包括：每秒处理超过1045笔交易。支持百万级的参与者。参与者只需要一个智能手机。数据流量使用，每天60兆，传统使用gossip的数据量是其700倍。bolckene蜂窝数据环境下更友好。

几兆数据的存储。不是很耗电。blockene在后台运行，用户甚至不会注意它。

blockene到底是怎么设计的呢？

blockene的设计采用了一种完美的民主。最重要的参与实体是公民，citizens。百万级的数量。公民的资源是有限的，他们只有一个智能手机。我们假设在这种数量级下，三分之二的公民的诚实的。blockene系统中的决策都是由大部分的公民做出的。比如，某个交易是否有效，哪些交易将被记录到区块中。

另外一类实体是政治家，politicians。政治家可以运行资源丰富的服务器。政治家不一定能取得公民的信任。在blockene的系统中，最多能够容忍80%的政治家是不诚实的。在blockene系统中，政治家无法投票。他们能做的只有执行决策。决策是大多数公民认可的。

在这样的信任模型下，我们接下来关注，谁来扮演传统区块链中的关键角色。在这个系统中，可信的数据指的是被大多数公民签名的数据。

大多数公民指的是从百万级公民中随机选出的一个委员会中的大多数公民。

再来看存储。区块链系统中的参与者存储完整的账本。但是blockene中的公民无法存储账本。因此只有政治家存储完整账本。
公民为了执行角色，需要从政治家那里读取小部分的数据。

通信是另一个关键的责任。区块链系统中的参与者使用gossip进行通信，来交换当前的世界状态。

公民为了提交区块、验证区块也需要互相通信。在blockene中，gossip通信是非直接进行的。

如果公民中的提案发起者想要提交一个区块，他将其写给一个政治家。政治家gossip给另外的政治家。其他公民从政治家那里读取区块。因此公民间的gossip通信是非直接进行的。

计算是公民需要进行的。区块验证和签名验证。

我们提到过80%的政治家可以是非诚实的。在这样的情况下，如何保障共识正确进行呢？

一个简化的特性是：我们只信任一个被大多数公民签名的消息。政治家无法伪造信息。

非诚实的政治家可以发起一些攻击，比如说：

陈旧性攻击：当公民请求最新的区块，政治家返回一个旧的区块。

遗忘攻击：当公民提交一个区块，政治家丢弃该区块，不将其写入区块链。

世界视图碎片化攻击：政治家有选择性地传输某些世界状态给一部分公民，另一些世界状态给另一部分公民。以此来阻止公民间的共识。

blockene针对这些攻击，提出了一些技术来解决问题。

为了应对陈旧性攻击。使用了可验证的重复读。不是从单一的政治家那里读数据，从安全的样本中的政治家那里读取数据。

只要5个里面有一个政治家提供了真实数据，公民就可以获得真实的区块链世界状态。

类似地，为了防御丢弃攻击，向安全样本中的政治家写区块，至少有一个政治家会把区块广播出去。

在这里对gossip的要求是，如果有一个诚实的政治家得到信息，所有诚实的政治家都需要得到该信息。在传统的gossip里面，这是难以保证的。
一个节点只连接5~10个其他节点。blockene使用了一种名为优先gossip的机制来保障诚实政治家得到信息。

在移动设备的环境下，公民手机的资源是非常有限的。一个公民不可能验证所有的区块。

blockene验证区块的责任是交由一个委员会执行的。委员会2000个成员从百万级的公民中随机选出。

子委员会是由密码学算法选择的。每一个区块的委员会成员是不同的。一个公民属于委员会，可以向其他公民证明这件事情。
共识的过程类似algoland，但是修改了一些地方。使得消耗的电量更少。

一个挑战是，公民需要验证交易，比如为了防止双花，需要知道当前某个地址的余额。如何从政治家那里可信地获取世界状态，是blockene需要解决的问题。

系统设计的具有可扩展性。
如果公民的数量增加十倍，从100万到1000万。每个公民出现在委员会中的机会会减少十倍。对于政治家的消息请求是相对固定的，因为委员会成员的数量固定。

如果增加政治家的数量，每个公民的数据读取量基本不变，因为公民和固定数量的安全政治家样本通信。每个政治家的数据读取量也基本不变，因为有限gossip策略。

对于女巫攻击，如果恶意用户创造了许多安卓虚拟机来参与共识投票，如何应对呢？

blockene使用TEE，基于硬件的可信执行环境来进行指纹验证。保障一个手机只对应一个数字身份，也就是公钥。
可以和另外的真实世界身份绑定，比如身份证。

公民应用是一个安卓APP。政治家是用C++编写的服务器，基于状态机的架构。

基于 Azure 云服务 在多个地区的无线局域网中进行了实验测试。安卓虚拟机运行公民程序，云端运行政治家程序。

下面这张图是blockene的交易吞吐量。200个政治家，每个8核，40兆每秒的网络带宽。
2000个公民，每个1核，1兆每秒的网络带宽。每个群体都分成两组，美国东西部。

在不同的诚实政治家百分比下测试的交易吞吐量结果。

这条线是，政治家和公民全部诚实，的情况，交易吞吐量看斜率，是1045。下面这两天线是不诚实者增加的一个情况。不诚实的参与者越多，系统交易吞吐量越小。不诚实的政治家可以使得公民看到的交易数量减少。公民提交的区块中包含的交易数量也越少。不诚实的公民如果作为提案提交者，会使得共识提交一个空的区块。

这张图包含的信息是，即便存在不诚实的参与者，blockene也可以在保障安全的情况下，达到比较高的交易吞吐量。

政治家存储区块链的世界状态，使用merkle tree。公民在验证交易时，需要从政治家那里读取数据。并确认数据真实性。

一种简单的做法是，将每个key的关键路径下载下来。在公民的手机端做验证。但是这种方法代价过高。

blockene采用一种新的做法，将大部分工作外包给政治家来完成。公民执行 点检查 协议，来保障查询结果的正确性。
这张表对比了优化前后，对于世界状态读取、更新操作的数据下载量、时间。简单方法需要240s来验证一个区块，而优化方法12s可以验证一个区块。

blockene的一个区块延迟大概是90s。显然优化方法更好。

总结一下。blockene首次在移动设备中引入区块链系统。移动设备可以作为一等公民，真正地去参与到共识过程中。并且使用了一些新方法，将网络、存储资源消耗量减少了2到3个数量级。

系统信任设计是两层的，公民+政治家。

在安全性和性能方面进行权衡取舍。把工作交给性能强大，但是不一定能够信任的节点来执行。

轻量级的公民仍然可以验证区块，执行正确性检查。在论文中对安全性、可生存性、公平性进行了形式化证明。

这种架构可以为边缘计算设备中的状态管理提供新的思路。

Blockene:A High Throughput Blockchain over Mobile Devices, OSDI 2020